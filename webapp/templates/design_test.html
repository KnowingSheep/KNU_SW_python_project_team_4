<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>êµí†µì‚¬ê³  ì‹œê°í™”</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      display: flex;
      height: 100vh;
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* ì™¼ìª½ í•„í„° í”„ë ˆì„ */
    #filter-panel {
      width: 320px;
      padding: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 2px 0 20px rgba(0,0,0,0.15);
      overflow-y: auto;
      position: relative;
      transition: width 0.3s ease;
      z-index: 1001;
    }

    #filter-panel.collapsed {
      width: 0;
      padding: 0;
      overflow: hidden;
      transition: width 0.3s ease;
    }

    #filter-panel.collapsed .filter-content {
      display: none;
    }

    .filter-content {
      padding: 20px;
      height: 100%;
      overflow-y: auto;
    }

    .filter-header {
      color: white;
      text-align: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(255,255,255,0.2);
    }

    .filter-header h2 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .filter-header p {
      margin: 8px 0 0 0;
      opacity: 0.9;
      font-size: 14px;
    }

    .filter-section {
      background: rgba(255,255,255,0.95);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .filter-section:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(0,0,0,0.15);
    }

    .filter-section h3 {
      margin: 0 0 15px 0;
      color: #2c3e50;
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-section h3::before {
      content: "";
      width: 4px;
      height: 20px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 2px;
    }

    .filter-group {
      margin-bottom: 16px;
    }

    .filter-group:last-child {
      margin-bottom: 0;
    }

    .filter-label {
      display: block;
      margin-bottom: 6px;
      color: #34495e;
      font-size: 14px;
      font-weight: 500;
    }

    .filter-select, .filter-input {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e1e8ed;
      border-radius: 8px;
      font-size: 14px;
      background: white;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      box-sizing: border-box;
    }

    .filter-select:focus, .filter-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .checkbox-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 8px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      border-radius: 6px;
      transition: background-color 0.2s ease;
      cursor: pointer;
    }

    .checkbox-item:hover {
      background-color: rgba(102, 126, 234, 0.05);
    }

    .checkbox-item input[type="checkbox"] {
      margin: 0;
      transform: scale(1.1);
      accent-color: #667eea;
    }

    .checkbox-item label {
      font-size: 13px;
      color: #34495e;
      cursor: pointer;
      margin: 0;
    }

    .severity-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 8px;
    }

    .severity-item {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      border: 2px solid transparent;
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .severity-item:hover {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.05);
    }

    .severity-item.active {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.1);
    }

    .severity-item .severity-icon {
      font-size: 20px;
      margin-bottom: 4px;
      display: block;
    }

    .severity-item .severity-label {
      font-size: 12px;
      font-weight: 500;
      color: #34495e;
    }

    .range-container {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .range-input {
      flex: 1;
      padding: 8px 10px;
      border: 2px solid #e1e8ed;
      border-radius: 6px;
      font-size: 13px;
      text-align: center;
    }

    .filter-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 20px;
    }

    .btn {
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #f8f9fa;
      color: #6c757d;
      border: 2px solid #e9ecef;
    }

    .btn-secondary:hover {
      background: #e9ecef;
      color: #495057;
    }

    .stats-summary {
      background: rgba(255,255,255,0.2);
      border-radius: 12px;
      padding: 15px;
      margin-top: 20px;
      color: white;
      text-align: center;
      backdrop-filter: blur(10px);
    }

    .stats-number {
      font-size: 24px;
      font-weight: 700;
      display: block;
      margin-bottom: 4px;
    }

    .stats-label {
      font-size: 12px;
      opacity: 0.9;
    }

    #toggle-panel {
      position: absolute;
      top: 100px;
      left: 0;
      z-index: 10;
      width: 36px;
      height: 36px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 0 8px 8px 0;
      cursor: pointer;
      font-size: 16px;
      line-height: 36px;
      text-align: center;
      padding: 0;
      z-index: 2000;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }

    #toggle-panel:hover {
      background: #f8f9fa;
      box-shadow: 2px 0 15px rgba(0,0,0,0.15);
    }

    #loading-indicator {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 8px 16px;
      background: rgba(255,255,255,0.95);
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      font-weight: 600;
      display: none;
      z-index: 1100;
      color: #667eea;
    }

    /* ì˜¤ë¥¸ìª½ ì§€ë„ í”„ë ˆì„ */
    #map-container {
      flex: 1;
      position: relative;
    }

    #map {
      height: 100%;
      width: 100%;
    }

    .map-controls {
      position: absolute;
      top: 15px;
      left: 60px;
      background-color: white;
      padding: 12px 16px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .map-controls select {
      border: 2px solid #e1e8ed;
      border-radius: 6px;
      padding: 6px 10px;
      margin-left: 8px;
      font-size: 14px;
    }

    .leaflet-tooltip {
      text-align: center;
      background: transparent;
      border: none;
      box-shadow: none;
      color: black;
      font-weight: bold;
      font-size: 14px;
      padding: 0;
    }

    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
    .filter-content::-webkit-scrollbar {
      width: 6px;
    }

    .filter-content::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
    }

    .filter-content::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.3);
      border-radius: 3px;
    }

    .filter-content::-webkit-scrollbar-thumb:hover {
      background: rgba(255,255,255,0.5);
    }
  </style>
</head>
<body>
  <div id="filter-panel">
    <div class="filter-content">
      <div class="filter-header">
        <h2>ğŸš— êµí†µì‚¬ê³  ë¶„ì„</h2>
        <p>ì¡°ê±´ì„ ì„ íƒí•˜ì—¬ ë°ì´í„°ë¥¼ í•„í„°ë§í•˜ì„¸ìš”</p>
      </div>

      <!-- ì‹œê°„ í•„í„° -->
      <div class="filter-section">
        <h3>ğŸ“… ì‹œê°„ ì¡°ê±´</h3>
        <div class="filter-group">
          <label class="filter-label">ì£¼ì•¼ êµ¬ë¶„</label>
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input type="checkbox" id="day" checked>
              <label for="day">ì£¼ê°„</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="night" checked>
              <label for="night">ì•¼ê°„</label>
            </div>
          </div>
        </div>
        <div class="filter-group">
          <label class="filter-label">ìš”ì¼</label>
          <select class="filter-select" id="dayOfWeek">
            <option value="">ì „ì²´</option>
            <option value="ì›”">ì›”ìš”ì¼</option>
            <option value="í™”">í™”ìš”ì¼</option>
            <option value="ìˆ˜">ìˆ˜ìš”ì¼</option>
            <option value="ëª©">ëª©ìš”ì¼</option>
            <option value="ê¸ˆ">ê¸ˆìš”ì¼</option>
            <option value="í† ">í† ìš”ì¼</option>
            <option value="ì¼">ì¼ìš”ì¼</option>
          </select>
        </div>
      </div>

      <!-- ì‚¬ê³  ìœ í˜• í•„í„° -->
      <div class="filter-section">
        <h3>ğŸš§ ì‚¬ê³  ìœ í˜•</h3>
        <div class="filter-group">
          <label class="filter-label">ëŒ€ë¶„ë¥˜</label>
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input type="checkbox" id="car-car" checked>
              <label for="car-car">ì°¨ëŒ€ì°¨</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="car-single" checked>
              <label for="car-single">ì°¨ëŸ‰ë‹¨ë…</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="car-person" checked>
              <label for="car-person">ì°¨ëŒ€ì‚¬ëŒ</label>
            </div>
          </div>
        </div>
      </div>

      <!-- ì‹¬ê°ë„ í•„í„° -->
      <div class="filter-section">
        <h3>âš ï¸ ì‚¬ê³  ì‹¬ê°ë„</h3>
        <div class="severity-grid">
          <div class="severity-item active" data-type="death">
            <span class="severity-icon">ğŸ’€</span>
            <span class="severity-label">ì‚¬ë§ì‚¬ê³ </span>
          </div>
          <div class="severity-item active" data-type="serious">
            <span class="severity-icon">ğŸš‘</span>
            <span class="severity-label">ì¤‘ìƒì‚¬ê³ </span>
          </div>
          <div class="severity-item active" data-type="minor">
            <span class="severity-icon">ğŸ¥</span>
            <span class="severity-label">ê²½ìƒì‚¬ê³ </span>
          </div>
          <div class="severity-item active" data-type="injury">
            <span class="severity-icon">ğŸ©¹</span>
            <span class="severity-label">ë¶€ìƒì‹ ê³ </span>
          </div>
        </div>
        
        <div class="filter-group" style="margin-top: 16px;">
          <label class="filter-label">ì‚¬ìƒì ìˆ˜ ë²”ìœ„</label>
          <div class="range-container">
            <input type="number" class="range-input" placeholder="ìµœì†Œ" min="0" id="minCasualties">
            <span>~</span>
            <input type="number" class="range-input" placeholder="ìµœëŒ€" min="0" id="maxCasualties">
          </div>
        </div>
      </div>

      <!-- ë„ë¡œ ì¡°ê±´ í•„í„° -->
      <div class="filter-section">
        <h3>ğŸ›£ï¸ ë„ë¡œ ì¡°ê±´</h3>
        <div class="filter-group">
          <label class="filter-label">ë„ë¡œ í˜•íƒœ</label>
          <select class="filter-select" id="roadType">
            <option value="">ì „ì²´</option>
            <option value="ë‹¨ì¼ë¡œ">ë‹¨ì¼ë¡œ</option>
            <option value="êµì°¨ë¡œ">êµì°¨ë¡œ</option>
            <option value="ê³ ì†ë„ë¡œ">ê³ ì†ë„ë¡œ</option>
            <option value="í„°ë„">í„°ë„</option>
            <option value="êµëŸ‰">êµëŸ‰</option>
          </select>
        </div>
      </div>

      <!-- ë‹¹ì‚¬ì í•„í„° -->
      <div class="filter-section">
        <h3>ğŸ‘¥ ë‹¹ì‚¬ì ìœ í˜•</h3>
        <div class="filter-group">
          <label class="filter-label">ê°€í•´ì ì°¨ëŸ‰</label>
          <select class="filter-select" id="perpetratorType">
            <option value="">ì „ì²´</option>
            <option value="ìŠ¹ìš©ì°¨">ìŠ¹ìš©ì°¨</option>
            <option value="í™”ë¬¼ì°¨">í™”ë¬¼ì°¨</option>
            <option value="ìŠ¹í•©ì°¨">ìŠ¹í•©ì°¨</option>
            <option value="ì´ë¥œì°¨">ì´ë¥œì°¨</option>
            <option value="ìì „ê±°">ìì „ê±°</option>
            <option value="ë³´í–‰ì">ë³´í–‰ì</option>
          </select>
        </div>
        <div class="filter-group">
          <label class="filter-label">í”¼í•´ì ìœ í˜•</label>
          <select class="filter-select" id="victimType">
            <option value="">ì „ì²´</option>
            <option value="ìŠ¹ìš©ì°¨">ìŠ¹ìš©ì°¨</option>
            <option value="í™”ë¬¼ì°¨">í™”ë¬¼ì°¨</option>
            <option value="ìŠ¹í•©ì°¨">ìŠ¹í•©ì°¨</option>
            <option value="ì´ë¥œì°¨">ì´ë¥œì°¨</option>
            <option value="ìì „ê±°">ìì „ê±°</option>
            <option value="ë³´í–‰ì">ë³´í–‰ì</option>
          </select>
        </div>
      </div>

      <!-- ë²•ê·œìœ„ë°˜ í•„í„° -->
      <div class="filter-section">
        <h3>âš–ï¸ ë²•ê·œ ìœ„ë°˜</h3>
        <div class="filter-group">
          <label class="filter-label">ìœ„ë°˜ ìœ í˜•</label>
          <select class="filter-select" id="violationType">
            <option value="">ì „ì²´</option>
            <option value="ì•ˆì „ìš´ì „ ì˜ë¬´ ë¶ˆì´í–‰">ì•ˆì „ìš´ì „ ì˜ë¬´ ë¶ˆì´í–‰</option>
            <option value="ì‹ í˜¸ìœ„ë°˜">ì‹ í˜¸ìœ„ë°˜</option>
            <option value="ì¤‘ì•™ì„ ì¹¨ë²”">ì¤‘ì•™ì„ ì¹¨ë²”</option>
            <option value="ì†ë„ìœ„ë°˜">ì†ë„ìœ„ë°˜</option>
            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
          </select>
        </div>
      </div>

      <!-- ì•¡ì…˜ ë²„íŠ¼ -->
      <div class="filter-actions">
        <button class="btn btn-primary" id="applyFilters">í•„í„° ì ìš©</button>
        <button class="btn btn-secondary" id="resetFilters">ì´ˆê¸°í™”</button>
      </div>

      <!-- í†µê³„ ìš”ì•½ -->
      <div class="stats-summary">
        <span class="stats-number" id="filteredCount">1,234</span>
        <span class="stats-label">í•„í„°ë§ëœ ì‚¬ê³  ê±´ìˆ˜</span>
      </div>
    </div>
  </div>

  <div id="map-container">
    <button id="toggle-panel">â—€</button>
    <div id="loading-indicator">
      ë°ì´í„° ë¡œë”© ì¤‘...
    </div>
    <div class="map-controls">
      <label for="yearSelect">ğŸ“… ë…„ë„ ì„ íƒ:</label>
      <select id="yearSelect">
      </select>
    </div>

    <div id="map"></div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    let map = L.map("map", {
        minZoom: 7,
        maxZoom: 20,
        maxBounds: [
        [32.5, 124.0],
        [39.5, 132.0]
        ],
        maxBoundsViscosity: 1.0
    }).setView([36.5, 127.5], 7);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { minZoom: 5, maxZoom: 20 }).addTo(map);

    const ZOOM_SIDO = 9;
    const ZOOM_SGG = 11;

    const icons = {
      ì°¨ëŒ€ì°¨: L.icon({ iconUrl: "/static/icons/cvc.svg", iconSize: [32, 32] }),
      ì°¨ëŸ‰ë‹¨ë…: L.icon({ iconUrl: "/static/icons/cs.svg", iconSize: [32, 32] }),
      ì°¨ëŒ€ì‚¬ëŒ: L.icon({ iconUrl: "/static/icons/cvm.svg", iconSize: [32, 32] })
    };

    let layerGroup = L.layerGroup().addTo(map);

    let mouseLatLng = map.getCenter();
    let currentYear = 2012;
    let currentProvince = null;
    let currentCity = null;

    const provinceCache = new Map();
    const cityCache = new Map();
    const accidentCache = new Map();

    // í•„í„° ê´€ë ¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.addEventListener('DOMContentLoaded', function() {
      // ì‹¬ê°ë„ í•„í„° í† ê¸€
      document.querySelectorAll('.severity-item').forEach(item => {
        item.addEventListener('click', function() {
          this.classList.toggle('active');
        });
      });

      // í•„í„° ì ìš© ë²„íŠ¼
      document.getElementById('applyFilters').addEventListener('click', function() {
        applyFilters();
      });

      // ì´ˆê¸°í™” ë²„íŠ¼
      document.getElementById('resetFilters').addEventListener('click', function() {
        resetFilters();
      });

      // íŒ¨ë„ í† ê¸€
      const filterPanel = document.getElementById("filter-panel");
      const toggleButton = document.getElementById("toggle-panel");

      toggleButton.addEventListener("click", () => {
        filterPanel.classList.toggle("collapsed");
        
        if (filterPanel.classList.contains("collapsed")) {
          toggleButton.textContent = "â–¶";
        } else {
          toggleButton.textContent = "â—€";
        }

        setTimeout(() => {
          map.invalidateSize();
        }, 300);
      });
    });

    function applyFilters() {
      // ì—¬ê¸°ì— í•„í„° ì ìš© ë¡œì§ êµ¬í˜„
      console.log('í•„í„° ì ìš©ë¨');
      // í•„í„°ë§ëœ ê²°ê³¼ ê°œìˆ˜ ì—…ë°ì´íŠ¸
      document.getElementById('filteredCount').textContent = Math.floor(Math.random() * 1000) + 100;
    }

    function resetFilters() {
      // ëª¨ë“  ì²´í¬ë°•ìŠ¤ ì²´í¬
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = true);
      
      // ëª¨ë“  select ì´ˆê¸°í™”
      document.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
      
      // ìˆ«ì ì…ë ¥ ì´ˆê¸°í™”
      document.querySelectorAll('input[type="number"]').forEach(input => input.value = '');
      
      // ì‹¬ê°ë„ í•„í„° ëª¨ë‘ í™œì„±í™”
      document.querySelectorAll('.severity-item').forEach(item => item.classList.add('active'));
      
      // í†µê³„ ì´ˆê¸°í™”
      document.getElementById('filteredCount').textContent = '1,234';
    }

    function debounce(fn, delay) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => fn(...args), delay);
      };
    }

    async function loadYears() {
      // ì„ì‹œ ë°ì´í„°ë¡œ ë…„ë„ ì˜µì…˜ ìƒì„±
      const years = [2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022];
      let select = document.getElementById("yearSelect");
      select.innerHTML = years.map(y => `<option value="${y}">${y}ë…„</option>`).join('');
      
      select.addEventListener("change", () => {
        currentYear = select.value;
        if (currentProvince != null && currentCity != null) {
          loadAccidents(currentYear, currentProvince, currentCity);
        }
        else if (currentProvince != null && currentCity == null) {
          loadCities(currentYear, currentProvince);
        }
        else {
          loadProvinces(currentYear);
        }
      });

      loadProvinces(select.value);
    }

    async function loadProvinces(year) {
      // ì„ì‹œ ë°ì´í„°
      const provinces = [
        { province: 'ì„œìš¸íŠ¹ë³„ì‹œ', lat: 37.5665, lng: 126.9780 },
        { province: 'ê²½ê¸°ë„', lat: 37.4138, lng: 127.5183 },
        { province: 'ì¸ì²œê´‘ì—­ì‹œ', lat: 37.4563, lng: 126.7052 }
      ];
      renderProvinces(provinces);
    }

    function renderProvinces(provinces) {
      layerGroup.clearLayers();
      provinces.forEach(prov => {
        let marker = L.marker([prov.lat, prov.lng]).addTo(layerGroup);
        marker.bindPopup(prov.province);
        marker.bindTooltip(prov.province, { permanent: true, direction: 'top', offset: [-15, 0] }).openTooltip();
        marker.on("click", () => {
          currentProvince = prov.province;
          currentCity = null;
          map.flyTo(marker.getLatLng(), ZOOM_SIDO);
          loadCities(currentYear, prov.province);
        });
      });
    }

    async function loadCities(year, province) {
      // ì„ì‹œ ë°ì´í„°
      const cities = [
        { city: 'ê°•ë‚¨êµ¬', lat: 37.5172, lng: 127.0473 },
        { city: 'ê°•ì„œêµ¬', lat: 37.5509, lng: 126.8495 }
      ];
      renderCities(cities);
    }

    function renderCities(cities) {
      layerGroup.clearLayers();
      cities.forEach(city => {
        let marker = L.marker([city.lat, city.lng]).addTo(layerGroup);
        marker.bindPopup(city.city);
        marker.bindTooltip(city.city, { permanent: true, direction: 'top', offset: [-10, -10] }).openTooltip();
        marker.on("click", () => {
          currentCity = city.city;
          map.flyTo(marker.getLatLng(), ZOOM_SGG);
          loadAccidents(currentYear, currentProvince, currentCity);
        });
      });
    }

    async function loadAccidents(year, province, city) {
      // ì„ì‹œ ë°ì´í„°
      const accidents = [
        { lat: 37.5172, lng: 127.0473, type_major: 'ì°¨ëŒ€ì°¨', date: '2012-05-09', desc: 'ì¶”ëŒì‚¬ê³ ' }
      ];
      renderAccidents(accidents);
    }

    function renderAccidents(accidents) {
      layerGroup.clearLayers();
      accidents.forEach(acc => {
        let icon = icons[acc.type_major] || icons["ì°¨ëŒ€ì°¨"];
        let marker = L.marker([acc.lat, acc.lng], { icon }).addTo(layerGroup);
        marker.bindPopup(`<b>${acc.date}</b><br/>${acc.desc}`);
      });
    }

    // ë¡œë”© ì¸ë””ì¼€ì´í„°
    const loadingIndicator = document.getElementById("loading-indicator");

    function showLoading() {
      loadingIndicator.style.display = "block";
    }

    function hideLoading() {
      loadingIndicator.style.display = "none";
    }

    async function fetchWithLoading(url) {
      try {
        showLoading();
        // ì„ì‹œë¡œ ë¹ˆ ë°°ì—´ ë°˜í™˜
        return [];
      } finally {
        hideLoading();
      }
    }

    // ë§µ ì´ë²¤íŠ¸ ì²˜ë¦¬
    map.on("mousemove", (e) => {
      mouseLatLng = e.latlng;
    });

    map.on("zoomend", debounce(() => {
      const zoom = map.getZoom();

      if (zoom < ZOOM_SIDO) {
        currentProvince = null;
        currentCity = null;
        loadProvinces(currentYear);
      } else if (zoom < ZOOM_SGG && zoom >= ZOOM_SIDO) {
        currentCity = null;
        if (currentProvince != null) {
          loadCities(currentYear, currentProvince);
        }
      } else if (zoom >= ZOOM_SGG) {
        if (currentProvince != null && currentCity != null) {
          loadAccidents(currentYear, currentProvince, currentCity);
        }
      }
    }, 300));

    // ì´ˆê¸°í™”
    loadYears();
  </script>
</body>
</html>