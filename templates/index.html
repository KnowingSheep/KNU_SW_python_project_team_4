<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>êµí†µì‚¬ê³  ë¶„ì„ ì‹œìŠ¤í…œ</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
</head>

<body>
  <div class="background-pattern"></div>
  <div class="floating-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
  </div>

  <div class="container">
    <nav class="nav-bar">
      <div class="nav-logo">
        <div class="nav-icon">TS</div>
        <div class="nav-title">Traffic Safety</div>
      </div>
      <div class="nav-badge">v0.1</div>
    </nav>

    <section class="hero-section">
      <h1 class="hero-title">êµí†µì‚¬ê³  ë¶„ì„ ì‹œìŠ¤í…œ</h1>
      <p class="hero-subtitle">
        ë°ì´í„° ë¶„ì„ìœ¼ë¡œ êµí†µì‚¬ê³ ë¥¼ ì˜ˆë°©í•˜ê³ <br>
        ë” ì•ˆì „í•œ ë„ë¡œ í™˜ê²½ì„ ë§Œë“¤ì–´ê°‘ë‹ˆë‹¤
      </p>

      <div class="stats-bar">
        <div class="stat-item">
          <span class="stat-number" id="top-year">-</span>
          <span class="stat-label">ìµœë‹¤ ë°œìƒ ì—°ë„</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="top-weekday">-</span>
          <span class="stat-label">ì‚¬ê³  ìµœë‹¤ ìš”ì¼</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="top-province">-</span>
          <span class="stat-label">ì‚¬ê³  ìµœë‹¤ ì§€ì—­</span>
        </div>
      </div>
    </section>

    <section class="menu-section">
      <div class="menu-card map-card" onclick="navigateToMap()">
        <div class="card-header">
          <div class="card-icon">ğŸ—ºï¸</div>
          <h2 class="card-title">ì‚¬ê³  ì§€ë„ ë¶„ì„</h2>
        </div>
        <p class="card-description">
          ì‹¤ì‹œê°„ êµí†µì‚¬ê³  ë°ì´í„°ë¥¼ ì§€ë„ì— ì‹œê°í™”í•˜ì—¬ ì‚¬ê³  ë‹¤ë°œ ì§€ì—­ê³¼
          ìœ„í—˜ êµ¬ê°„ì„ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
        <div class="card-features">
          <span class="feature-tag">ì—°ë„ë³„</span>
          <span class="feature-tag">ì¡°ê±´ë³„</span>
          <span class="feature-tag">ë¡œë“œë·°</span>
        </div>
      </div>

      <div class="menu-card stats-card" onclick="navigateToStats()">
        <div class="card-header">
          <div class="card-icon">ğŸ“Š</div>
          <h2 class="card-title">í†µê³„ ëŒ€ì‹œë³´ë“œ</h2>
        </div>
        <p class="card-description">
          ë‹¤ì–‘í•œ ì°¨íŠ¸ì™€ ê·¸ë˜í”„ë¡œ êµí†µì‚¬ê³  íŒ¨í„´ì„ ë¶„ì„í•˜ê³ 
          ì¸ì‚¬ì´íŠ¸ë¥¼ ë„ì¶œí•˜ì—¬ ì˜ˆë°© ëŒ€ì±…ì„ ìˆ˜ë¦½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
        <div class="card-features">
          <span class="feature-tag">íŠ¸ë Œë“œ ë¶„ì„</span>
          <span class="feature-tag">ë¦¬í¬íŠ¸ ìƒì„±</span>
        </div>
      </div>
      <div class="menu-card table-card" onclick="navigateToTable()">
        <div class="card-header">
          <div class="card-icon">ğŸ“„</div>
          <h2 class="card-title">ë°ì´í„° ì¡°íšŒ</h2>
        </div>
        <p class="card-description">
          êµí†µì‚¬ê³  ë°ì´í„°ë¥¼ í‘œ í˜•ì‹ìœ¼ë¡œ í™•ì¸í•˜ê³ <br>
          ë‹¤ì–‘í•œ ê¸°ì¤€ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
        <div class="card-features">
          <span class="feature-tag">í‘œ ë³´ê¸°</span>
          <span class="feature-tag">ê²€ìƒ‰</span>
        </div>
      </div>
    </section>

    <footer class="footer">
      <p>Â© 2025 Traffic Accidents Analasys and Visualization</p>
      <p>íŒŒì´ì¬ ê¸°ë°˜ ë¹…ë°ì´í„° ë¶„ì„ ê¸°ì´ˆ ê¸°ë§ í”„ë¡œì íŠ¸ 4ì¡°</p>
    </footer>
  </div>

  <script>
    function navigateToMap() {
      window.location.href = '/map';
    }

    function navigateToStats() {
      window.location.href = '/stats';
    }

    function navigateToTable() {
      window.location.href = '/table';
    }

    // ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    }, observerOptions);

    document.querySelectorAll('.menu-card').forEach(card => {
      observer.observe(card);
    });

    // í†µê³„ ì¹´ìš´í„° ì• ë‹ˆë©”ì´ì…˜
    function animateCounter(element, target) {
      let current = 0;
      const increment = target / 50;
      const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
          current = target;
          clearInterval(timer);
        }

        if (target.toString().includes('.')) {
          element.textContent = current.toFixed(1) + '%';
        } else {
          element.textContent = Math.floor(current).toLocaleString();
        }
      }, 20);
    }

    function animateCounter(element, target, suffix = '') {
      let current = 0;
      const isNumber = typeof target === 'number';
      const increment = isNumber ? target / 50 : 1;

      const timer = setInterval(() => {
        current += increment;
        if (isNumber && current >= target) {
          current = target;
          clearInterval(timer);
        } else if (!isNumber) {
          clearInterval(timer);
        }

        element.textContent = isNumber
          ? Math.floor(current).toLocaleString() + suffix
          : target;
      }, 20);
    }

    async function loadLiveStats() {
      try {
        const res = await fetch('/api/stats/summary');
        const data = await res.json();

        animateCounter(document.getElementById("top-year"), data.year);
        animateCounter(document.getElementById("top-weekday"), data.top_weekday);
        animateCounter(document.getElementById("top-province"), data.top_province);
      } catch (err) {
        console.error("í†µê³„ ë¡œë”© ì‹¤íŒ¨:", err);
      }
    }

    document.addEventListener("DOMContentLoaded", loadLiveStats);
  </script>
</body>

</html>